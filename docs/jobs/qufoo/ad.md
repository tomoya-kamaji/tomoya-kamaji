---
layout: default
title: 広告配信サーバー - モジュールオーナー
---

[← プロフィールに戻る](../../index.md)

## 概要

広告配信サーバーのモジュールオーナーとして従事

### 背景

- 元々、広告配信サーバのオーナーをしている方が退職するに辺り自分が任命された
- 広告配信は収益の源になっている箇所であるが、テストや監視の整備が不十分なところがあり整備を進めた

### やったこと

#### 要件定義、設計、機能開発

- ビジネスチームと協力して、広告配信の新規施策を立案
- 設計をチームリーダと話し合いドキュメントに起こす
- メインの開発を自分が行い、レビューをリーダにしていただきリリースを行う

上記のような手順で開発を行っていました

#### 重要ロジックのテストコードの追加、CI の整備

- 全体的にテストが書けていなかったので、単体テストをメインにテストコードの追加を行いました。統合テスト(API レベルのテスト)は保守コストが増える割には恩恵が小さいと考えているので、重要なロジックの単体テスト(広告配信のロジック)をメインにテストコードを追加しました

**結果**

- コードレビュー時にテストコードによって振る舞いが明確になり、負担が減った
- テストコードがロジックがドキュメントになり、後任の方のキャッチアップの手助けになった(と思っています)

#### 広告が不足検知のための監視の仕組みの整備

- 特定の状況下にて広告が配信されないパターンがありましたが、それを感知する仕組みがありませんでした。(特定のメディアに出す広告が足りないなど)
  そのために、GCP の以下のサービスを使い Slack に通知するための仕組みを作成した - Cloud Logging で広告が不足していることを logging する - その log をログベースの指標としてカウント - そのログベースの指標を Cloud Monitoring で監視　 → 　 Slack 通知

結果

- 今まで取りこぼしていた広告表示に気づくことができ対処できるようになった
  → ビジネスチーム経由でメディア様へ対応依頼を即座に行えて、1 ヶ月辺り 200,000imp ほどの改善に繋がった（金額にして`月2万円程度`の改善）

#### 広告の配信モデルの読み込み失敗の監視

- 広告配信サーバーの起動時にクリック率の予測モデルを読み込みを行う処理があったが、たまに読み込み失敗していることがあった。
  その際にエラーハンドリングとして予測モデルを使わない配信に切り替えていたが、モデルを使わない配信は収益が落ちてしまうという課題があった。
  (もしもモデルの読み込みエラーに 1 日気づかない場合は`20万`ほど収益が落ち込んでしまう）

- そのため上述したような広告不足監視と同じ仕組みで Slack に通知する仕組みを行った。
  (読み込み部分は Goroutine を使った処理になっており、Goroutine 時のエラーハンドリングやタイムアウトの仕組みを理解する上でかなり学びになりました)

**結果**

- 正常にモデルが使われていない状態に気づくことができ、収益が継続的に落ちる前に気づくことができ`約5万`ほどの収益に貢献できたと考えている(1 ヶ月トータル 6 時間ほど読み込まれなかったと仮定して)

---

[← プロフィールに戻る](../../index.md)
